import{a as Le}from"./chunk-SVAUCDM3.js";import{a as He}from"./chunk-HN2COD6C.js";import{b as Fe,d as Pe,e as Ee,f as D,i as S,k as ke,l as De,n as Te,p as Ve,q as Ie,r as Me,s as ze,v as Oe,w as Ne}from"./chunk-NOLICJZN.js";import{a as be,b as Ce,c as ye,d as Se,e as we}from"./chunk-HBV62KLX.js";import{A as te,Ja as oe,Kb as xe,Na as se,Ra as le,Wa as ce,X as ie,Ya as de,bb as pe,cb as me,db as ge,eb as _e,f as Q,fb as he,g as Y,j as q,ka as ne,la as re,m as J,oa as ae,qb as ue,r as K,rb as ve,sb as fe,t as X,x as Z,y as ee}from"./chunk-L2SPN6SO.js";import{$b as d,Bc as U,Ca as j,Db as c,Dc as $,Eb as w,Fb as I,Ic as W,Ob as n,Pb as r,Qb as y,T as B,Ub as x,Zb as _,bb as a,gb as C,la as m,lc as s,ma as g,mc as M,na as A,nc as f,oa as R,oc as z,pb as G,pc as O,rc as F,sc as P,tc as E,vb as u,x as H,yc as k,z as L}from"./chunk-EBI22OCP.js";import{a as V}from"./chunk-7CGTOI24.js";var N=()=>({standalone:!0});function Be(o,p){o&1&&(n(0,"span",9),s(1,"PRO"),r())}function Ae(o,p){if(o&1&&(n(0,"c-card",11)(1,"c-card-header")(2,"strong"),s(3,"Prediction Results"),r()(),n(4,"c-card-body"),y(5,"c-chart",26),r()()),o&2){let e=d(2);a(5),c("data",e.singlePredictionChartData)("options",e.pieChartOptions)}}function Re(o,p){o&1&&(n(0,"div",27)(1,"p",22),s(2,"No prediction history available. Make a prediction to see results here."),r()())}function je(o,p){if(o&1){let e=x();n(0,"tr",31),_("click",function(){let t=m(e).$implicit,l=d(3);return g(l.showHistoryItemChart(t))}),n(1,"td",32),s(2),r(),n(3,"td")(4,"span",33),s(5),r()(),n(6,"td"),s(7),r(),n(8,"td")(9,"span",34),_("click",function(t){let l=m(e).$implicit;return d(3).showCategoriesModal(l.sentiment_scores),g(t.stopPropagation())}),s(10," View Details "),r()()()}if(o&2){let e=p.$implicit,i=d(3);I("selected-history-item",i.isSelectedHistoryItem(e)),a(),c("title",e.text),a(),f(" ",e.text," "),a(2),w("background-color",i.getCategoryColor(e.final_prediction)),a(),f(" ",e.final_prediction," "),a(2),f("",e.confidence,"%")}}function Ge(o,p){if(o&1&&(n(0,"div",28)(1,"table",29)(2,"thead")(3,"tr")(4,"th"),s(5,"Text"),r(),n(6,"th"),s(7,"Prediction"),r(),n(8,"th"),s(9,"Confidence"),r(),n(10,"th"),s(11,"Sentiment Scores"),r()()(),n(12,"tbody"),u(13,je,11,8,"tr",30),r()()()),o&2){let e=d(2);a(13),c("ngForOf",e.getPaginatedData(e.singlePredictionHistory,e.historyCurrentPage,e.historyPageSize))}}function Ue(o,p){if(o&1){let e=x();n(0,"c-page-item",40)(1,"a",37),_("click",function(){let t=m(e).$implicit,l=d(3);return g(l.changePage(t,"history"))}),s(2),r()()}if(o&2){let e=p.$implicit,i=d(3);c("active",i.historyCurrentPage===e),a(2),f(" ",e+1," ")}}function $e(o,p){if(o&1){let e=x();n(0,"c-pagination",35)(1,"c-page-item",36)(2,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(0,"history"))}),s(3,"First"),r()(),n(4,"c-page-item",36)(5,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(t.historyCurrentPage-1,"history"))}),n(6,"span",38),s(7,"\xAB"),r()()(),u(8,Ue,3,2,"c-page-item",39),n(9,"c-page-item",36)(10,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(t.historyCurrentPage+1,"history"))}),n(11,"span",38),s(12,"\xBB"),r()()(),n(13,"c-page-item",36)(14,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(t.Math.ceil(t.singlePredictionHistory.length/t.historyPageSize)-1,"history"))}),s(15,"Last"),r()()()}if(o&2){let e=d(2);a(),c("disabled",e.historyCurrentPage===0||e.singlePredictionHistory.length<=e.historyPageSize),a(3),c("disabled",e.historyCurrentPage===0||e.singlePredictionHistory.length<=e.historyPageSize),a(4),c("ngForOf",e.getVisiblePageNumbers(e.singlePredictionHistory.length,e.historyPageSize,e.historyCurrentPage)),a(),c("disabled",e.historyCurrentPage>=e.Math.ceil(e.singlePredictionHistory.length/e.historyPageSize)-1||e.singlePredictionHistory.length<=e.historyPageSize),a(4),c("disabled",e.historyCurrentPage>=e.Math.ceil(e.singlePredictionHistory.length/e.historyPageSize)-1||e.singlePredictionHistory.length<=e.historyPageSize)}}function We(o,p){if(o&1){let e=x();n(0,"div")(1,"c-row")(2,"c-col",10)(3,"c-card",11)(4,"c-card-header")(5,"strong"),s(6,"Single Line Input"),r()(),n(7,"c-card-body")(8,"form",12)(9,"div",13)(10,"label",14),s(11,"Provide the text to Predict"),r(),y(12,"textarea",15),r(),n(13,"div",16)(14,"button",17),_("click",function(){m(e);let t=d();return g(t.predictSingleText())}),s(15," Predict "),r()()()()(),u(16,Ae,6,2,"c-card",18),r(),n(17,"c-col",10)(18,"c-card")(19,"c-card-header")(20,"strong"),s(21,"Prediction History"),r()(),n(22,"c-card-body"),u(23,Re,3,0,"div",19)(24,Ge,14,1,"div",20),n(25,"div",21)(26,"div")(27,"small",22),s(28),r()(),u(29,$e,16,5,"c-pagination",23),n(30,"div")(31,"select",24),E("ngModelChange",function(t){m(e);let l=d();return P(l.historyPageSize,t)||(l.historyPageSize=t),g(t)}),_("change",function(){m(e);let t=d();return g(t.onPageSizeChange("history"))}),n(32,"option",25),s(33,"5 rows"),r(),n(34,"option",25),s(35,"10 rows"),r(),n(36,"option",25),s(37,"25 rows"),r(),n(38,"option",25),s(39,"50 rows"),r()()()()()()()()()}if(o&2){let e=d();a(8),c("formGroup",e.singlePredictionForm),a(6),c("disabled",!e.singlePredictionForm.valid||e.isProcessingSinglePrediction),a(2),c("ngIf",e.lastSinglePrediction),a(7),c("ngIf",e.singlePredictionHistory.length===0),a(),c("ngIf",e.singlePredictionHistory.length>0),a(4),O(" Showing ",e.historyCurrentPage*e.historyPageSize+1," to ",e.Math.min((e.historyCurrentPage+1)*e.historyPageSize,e.singlePredictionHistory.length)," of ",e.singlePredictionHistory.length," predictions "),a(),c("ngIf",e.singlePredictionHistory.length>0),a(2),F("ngModel",e.historyPageSize),c("ngModelOptions",k(15,N)),a(),c("value",5),a(2),c("value",10),a(2),c("value",25),a(2),c("value",50)}}function Qe(o,p){o&1&&(n(0,"div",59),s(1,"PRO"),r())}function Ye(o,p){if(o&1){let e=x();n(0,"button",62),_("click",function(t){m(e);let l=d().$implicit,h=d(2);return g(h.deleteCsvFile(l.id,t))}),s(1," \xD7 "),r()}}function qe(o,p){if(o&1){let e=x();n(0,"c-nav-item")(1,"a",60),_("click",function(){let t=m(e).$implicit,l=d(2);return g(l.selectCsvFile(t.id))}),s(2),u(3,Ye,2,0,"button",61),r()()}if(o&2){let e=p.$implicit,i=d(2);a(),c("active",i.activeCsvFile===e.id),a(),f(" ",e.name," "),a(),c("ngIf",!e.isDefault)}}function Je(o,p){if(o&1){let e=x();n(0,"tr")(1,"td",32),s(2),r(),n(3,"td")(4,"span",33),s(5),r()(),n(6,"td"),s(7),r(),n(8,"td")(9,"span",34),_("click",function(){let t=m(e).$implicit,l=d(3);return g(l.showCategoriesModal(t.sentiment_scores||t.categories))}),s(10," View Details "),r()()()}if(o&2){let e=p.$implicit,i=d(3);a(),c("title",e.text||e.Text),a(),f(" ",e.text||e.Text," "),a(2),w("background-color",i.getCategoryColor(e.final_prediction||e.Prediction)),a(),f(" ",e.final_prediction||e.Prediction," "),a(2),f("",e.confidence||e.Confidence,"%")}}function Ke(o,p){if(o&1){let e=x();n(0,"c-page-item",40)(1,"a",37),_("click",function(){let t=m(e).$implicit,l=d(3);return g(l.changePage(t,"bulk"))}),s(2),r()()}if(o&2){let e=p.$implicit,i=d(3);c("active",i.currentPage===e),a(2),f(" ",e+1," ")}}function Xe(o,p){if(o&1){let e=x();n(0,"c-card-body")(1,"c-card",11)(2,"c-card-header")(3,"strong"),s(4),r()(),n(5,"c-card-body"),y(6,"c-chart",63),r()(),n(7,"c-card")(8,"c-card-header")(9,"div",64)(10,"strong"),s(11),r(),n(12,"button",65),_("click",function(){m(e);let t=d(2);return g(t.downloadFile(t.currentCsvFile.id))}),A(),n(13,"svg",66),s(14,' class="me-1" viewBox="0 0 16 16"> '),y(15,"path",67),r(),s(16," Download CSV "),r()()(),R(),n(17,"c-card-body")(18,"div",68)(19,"table",29)(20,"thead")(21,"tr")(22,"th"),s(23,"Text"),r(),n(24,"th"),s(25,"Prediction"),r(),n(26,"th"),s(27,"Confidence"),r(),n(28,"th"),s(29,"Sentiment Scores"),r()()(),n(30,"tbody"),u(31,Je,11,6,"tr",45),r()()(),n(32,"div",21)(33,"div")(34,"small",22),s(35),r()(),n(36,"c-pagination",69)(37,"c-page-item",36)(38,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(0,"bulk"))}),s(39,"First"),r()(),n(40,"c-page-item",36)(41,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(t.currentPage-1,"bulk"))}),n(42,"span",38),s(43,"\xAB"),r()()(),u(44,Ke,3,2,"c-page-item",39),n(45,"c-page-item",36)(46,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(t.currentPage+1,"bulk"))}),n(47,"span",38),s(48,"\xBB"),r()()(),n(49,"c-page-item",36)(50,"a",37),_("click",function(){m(e);let t=d(2);return g(t.changePage(t.Math.ceil(t.currentCsvFile.data.length/t.pageSize)-1,"bulk"))}),s(51,"Last"),r()()(),n(52,"div")(53,"select",24),E("ngModelChange",function(t){m(e);let l=d(2);return P(l.pageSize,t)||(l.pageSize=t),g(t)}),_("change",function(){m(e);let t=d(2);return g(t.onPageSizeChange("bulk"))}),n(54,"option",25),s(55,"10 rows"),r(),n(56,"option",25),s(57,"25 rows"),r(),n(58,"option",25),s(59,"50 rows"),r(),n(60,"option",25),s(61,"100 rows"),r()()()()()()()}if(o&2){let e=d(2);a(4),f("",e.currentCsvFile.name," - Radar Chart"),a(2),c("data",e.currentCsvFile.chartData)("options",e.options),a(5),f("",e.currentCsvFile.name," - Data"),a(20),c("ngForOf",e.getPaginatedData(e.currentCsvFile.data,e.currentPage,e.pageSize)),a(4),O(" Showing ",e.currentPage*e.pageSize+1," to ",e.Math.min((e.currentPage+1)*e.pageSize,e.currentCsvFile.data.length)," of ",e.currentCsvFile.data.length," rows "),a(2),c("disabled",e.currentPage===0),a(3),c("disabled",e.currentPage===0),a(4),c("ngForOf",e.getVisiblePageNumbers(e.currentCsvFile.data.length,e.pageSize,e.currentPage)),a(),c("disabled",e.currentPage>=e.Math.ceil(e.currentCsvFile.data.length/e.pageSize)-1),a(4),c("disabled",e.currentPage>=e.Math.ceil(e.currentCsvFile.data.length/e.pageSize)-1),a(4),F("ngModel",e.pageSize),c("ngModelOptions",k(19,N)),a(),c("value",10),a(2),c("value",25),a(2),c("value",50),a(2),c("value",100)}}function Ze(o,p){o&1&&(n(0,"c-card-body",27)(1,"p",22),s(2,'No files selected. Please select a file from "My Files".'),r()())}function et(o,p){if(o&1&&(n(0,"p",70),s(1),r()),o&2){let e,i=d(2);a(),f(" Selected: ",(e=i.fileUploadForm.get("fileName"))==null?null:e.value," ")}}function tt(o,p){o&1&&(n(0,"div",71)(1,"p",72),s(2,"No pending files"),r()())}function it(o,p){if(o&1&&(n(0,"li",76)(1,"div",77)(2,"span",78),s(3,"Processing..."),r()(),n(4,"span",79),s(5),r(),n(6,"small",80),s(7,"processing..."),r()()),o&2){let e=p.$implicit;a(5),M(e.name)}}function nt(o,p){if(o&1&&(n(0,"div",73)(1,"ul",74),u(2,it,8,1,"li",75),r()()),o&2){let e=d(2);a(2),c("ngForOf",e.pendingFiles)}}function rt(o,p){if(o&1&&(n(0,"div",81)(1,"small",22),s(2),r()()),o&2){let e=d(2);a(2),f("Showing ",e.pendingFiles.length," files")}}function at(o,p){if(o&1){let e=x();n(0,"button",82),_("click",function(){m(e);let t=d(2);return g(t.clearFileSearch())}),s(1," \xD7 "),r()}}function ot(o,p){if(o&1&&(n(0,"div",71)(1,"p",72),s(2),r()()),o&2){let e=d(2);a(2),f(" ",e.myFiles.length===0?"No files available":"No matching files"," ")}}function st(o,p){if(o&1){let e=x();n(0,"li",85),_("click",function(){let t=m(e).$implicit,l=d(3);return g(l.loadFileToVisualization(t.id))}),n(1,"div",86)(2,"span",79),s(3),r(),n(4,"small",80),s(5),U(6,"date"),r()()()}if(o&2){let e=p.$implicit,i=d(3);c("active",i.activeCsvFile===e.id),a(3),M(e.name),a(2),f(" ",$(6,3,e.timestamp,"short")," ")}}function lt(o,p){if(o&1&&(n(0,"div",83)(1,"ul",74),u(2,st,7,6,"li",84),r()()),o&2){let e=d(2);a(2),c("ngForOf",e.filteredFiles)}}function ct(o,p){if(o&1&&(n(0,"div",81)(1,"small",22),s(2),r()()),o&2){let e=d(2);a(2),z(" Showing ",e.filteredFiles.length," of ",e.myFiles.length," files ")}}function dt(o,p){if(o&1&&(n(0,"div",81)(1,"small",22),s(2),r()()),o&2){let e=d(2);a(2),z(" Found ",e.filteredFiles.length," ",e.filteredFiles.length===1?"match":"matches"," ")}}function pt(o,p){if(o&1){let e=x();n(0,"div",87)(1,"div",88)(2,"h4"),s(3,"Upgrade to Pro to Access Bulk Prediction"),r(),n(4,"p"),s(5,"Process entire CSV files at once with our premium bulk prediction feature."),r(),n(6,"ul",89)(7,"li"),s(8,"Upload & analyze full datasets"),r(),n(9,"li"),s(10,"Get batch results instantly"),r(),n(11,"li"),s(12,"Export complete result sets"),r(),n(13,"li"),s(14,"Track processing history"),r()(),n(15,"button",90),_("click",function(){m(e);let t=d(2);return g(t.navigateToSubscription())}),s(16," Upgrade to Pro "),r(),n(17,"div",91)(18,"small"),s(19," If the button doesn't work, "),n(20,"a",92),s(21,"click here"),r(),s(22," instead. "),r()()()()}}function mt(o,p){if(o&1){let e=x();n(0,"div",41),u(1,Qe,2,0,"div",42),n(2,"div")(3,"c-row")(4,"c-col",43)(5,"c-card")(6,"c-card-header")(7,"c-nav",44),u(8,qe,4,3,"c-nav-item",45),r()(),u(9,Xe,62,20,"c-card-body",5)(10,Ze,3,0,"c-card-body",19),r()(),n(11,"c-col",46)(12,"c-card",11)(13,"c-card-header")(14,"strong"),s(15,"Upload CSV File"),r()(),n(16,"c-card-body")(17,"form",12)(18,"div",13)(19,"label",47),s(20,"Choose CSV file"),r(),n(21,"input",48),_("change",function(t){m(e);let l=d();return g(l.onFileSelected(t))}),r(),u(22,et,2,1,"p",49),r(),n(23,"div",50)(24,"button",17),_("click",function(){m(e);let t=d();return g(t.predictCsvFile())}),s(25," Predict "),r()()()()(),n(26,"c-card",11)(27,"c-card-header")(28,"strong"),s(29,"Pending Files"),r()(),n(30,"c-card-body"),u(31,tt,3,0,"div",51)(32,nt,3,1,"div",52)(33,rt,3,1,"div",53),r()(),n(34,"c-card")(35,"c-card-header")(36,"strong"),s(37,"My Files"),r()(),n(38,"c-card-body")(39,"div",13)(40,"div",54)(41,"input",55),E("ngModelChange",function(t){m(e);let l=d();return P(l.fileSearchQuery,t)||(l.fileSearchQuery=t),g(t)}),_("input",function(){m(e);let t=d();return g(t.filterFiles())}),r(),u(42,at,2,0,"button",56),r()(),u(43,ot,3,1,"div",51)(44,lt,3,1,"div",57)(45,ct,3,2,"div",53)(46,dt,3,2,"div",53),r()()()()(),u(47,pt,23,0,"div",58),r()}if(o&2){let e,i,t=d();a(),c("ngIf",!t.hasBulkAccess),a(),I("premium-content-blur",!t.hasBulkAccess),a(6),c("ngForOf",t.csvFiles),a(),c("ngIf",t.currentCsvFile),a(),c("ngIf",!t.currentCsvFile),a(7),c("formGroup",t.fileUploadForm),a(5),c("ngIf",(e=t.fileUploadForm.get("fileName"))==null?null:e.value),a(2),c("disabled",!((i=t.fileUploadForm.get("csvFile"))!=null&&i.value)),a(7),c("ngIf",t.pendingFiles.length===0),a(),c("ngIf",t.pendingFiles.length>0),a(),c("ngIf",t.pendingFiles.length>5),a(8),F("ngModel",t.fileSearchQuery),c("ngModelOptions",k(20,N)),a(),c("ngIf",t.fileSearchQuery),a(),c("ngIf",t.filteredFiles.length===0),a(),c("ngIf",t.filteredFiles.length>0),a(),c("ngIf",!t.fileSearchQuery&&t.myFiles.length>5),a(),c("ngIf",t.fileSearchQuery&&t.filteredFiles.length>0),a(),c("ngIf",!t.hasBulkAccess)}}function gt(o,p){if(o&1&&(n(0,"tr")(1,"td")(2,"span",33),s(3),r()(),n(4,"td"),s(5),r()()),o&2){let e=p.$implicit,i=d(2);a(2),w("background-color",i.getCategoryColor(e.name)),a(),f(" ",e.name," "),a(2),f("",e.value,"%")}}function _t(o,p){if(o&1){let e=x();n(0,"c-card",93)(1,"c-card-header",64)(2,"strong"),s(3,"Category Details"),r(),n(4,"button",94),_("click",function(){m(e);let t=d();return g(t.showCategoryModal=!1)}),s(5," \xD7 "),r()(),n(6,"c-card-body")(7,"table",95)(8,"thead")(9,"tr")(10,"th"),s(11,"Category"),r(),n(12,"th"),s(13,"Confidence"),r()()(),n(14,"tbody"),u(15,gt,6,4,"tr",45),r()()()()}if(o&2){let e=d();a(15),c("ngForOf",e.selectedCategories)}}function ht(o,p){if(o&1){let e=x();n(0,"div",96),_("click",function(){m(e);let t=d();return g(t.showCategoryModal=!1)}),r()}}var Ot=(()=>{class o{constructor(e,i,t,l,h,v){this.http=e,this.predictionService=i,this.subscriptionService=t,this.cdr=l,this.route=h,this.router=v,this._cachedChartData=null,this._lastPredictionTimeStamp=new Date,this.selectedHistoryItem=null,this.statusCheckSubscription=null,this.fileStatusSubscriptions=new Map,this.activeTab="single",this.activeCsvFile="",this.mainChart={type:"line"},this.mainChartRef=j(void 0),this.chart=[],this.fileSearchQuery="",this.filteredFiles=[],this.pageSize=10,this.currentPage=0,this.Math=Math,this.isProcessingSinglePrediction=!1,this.historyPageSize=5,this.historyCurrentPage=0,this.selectedCategories=[],this.showCategoryModal=!1,this.lastSinglePrediction=null,this.pieChartOptions={maintainAspectRatio:!1,plugins:{legend:{position:"right"}}},this.options={maintainAspectRatio:!1},this.pendingFiles=[],this.myFiles=[],this.singlePredictionHistory=[],this.singlePredictionForm=new D({textInput:new S("",{nonNullable:!0})}),this.predictionForm=new D({text:new S("",{nonNullable:!0})}),this.isPredicting=!1,this.fileUploadForm=new D({csvFile:new S(null),fileName:new S("")}),this.csvFiles=[],this.chartRadarData={labels:["Eating","Drinking","Sleeping","Designing","Coding","Cycling","Running"],datasets:[{label:"2020",backgroundColor:"rgba(179,181,198,0.2)",borderColor:"rgba(179,181,198,1)",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(179,181,198,1)",data:[65,59,90,81,56,55,40]}]}}get totalPages(){return this.currentCsvFile?Math.ceil(this.currentCsvFile.data.length/this.pageSize):0}ngOnInit(){this.route.data.subscribe(e=>{e.activeTab&&(this.activeTab=e.activeTab,console.log("Active tab from route data:",this.activeTab))}),this.router.events.pipe(L(e=>e instanceof Z)).subscribe(()=>{let e=this.router.url;e.includes("/dashboard/bulk")?this.activeTab="bulk":e.includes("/dashboard/single")&&(this.activeTab="single"),this.cdr.detectChanges()}),this.predictionService.getUserData().subscribe({next:e=>{this.singlePredictionHistory=e.predictionHistory,this.pendingFiles=e.pendingFiles,this.myFiles=e.completedFiles,this.filteredFiles=this.myFiles,this.csvFiles.length>0&&(this.activeCsvFile=this.csvFiles[0].id),this.singlePredictionHistory.length>0&&(this.lastSinglePrediction=V({},this.singlePredictionHistory[0]),this.selectedHistoryItem=this.singlePredictionHistory[0])},error:e=>{console.error("Error loading user data:",e),this.csvFiles=Ce,this.singlePredictionHistory=be,this.pendingFiles=ye,this.myFiles=Se,this.filteredFiles=this.myFiles,this.singlePredictionHistory.length>0&&(this.lastSinglePrediction=V({},this.singlePredictionHistory[0]),this.selectedHistoryItem=this.singlePredictionHistory[0])}})}showHistoryItemChart(e){this.selectedHistoryItem=e,this.lastSinglePrediction={text:e.text,final_prediction:e.final_prediction,confidence:e.confidence,sentiment_scores:e.sentiment_scores,timestamp:e.timestamp},this._cachedChartData=null}isSelectedHistoryItem(e){return this.selectedHistoryItem&&this.selectedHistoryItem.timestamp===e.timestamp}filterFiles(){if(!this.fileSearchQuery){this.filteredFiles=this.myFiles;return}let e=this.fileSearchQuery.toLowerCase();this.filteredFiles=this.myFiles.filter(i=>i.name.toLowerCase().includes(e))}clearFileSearch(){this.fileSearchQuery="",this.filterFiles()}selectCsvFile(e){this.activeCsvFile=e,this.currentPage=0}get currentCsvFile(){return this.csvFiles.find(e=>e.id===this.activeCsvFile)}predictSingleText(){let e=this.singlePredictionForm.get("textInput")?.value;!e||e.trim()===""||(this.isProcessingSinglePrediction=!0,this.predictionService.predictText(e).subscribe({next:i=>{try{let t=[];Array.isArray(i.sentiment_scores)?t=i.sentiment_scores.map(v=>({name:v.name==="neutral"?"Neutral":v.name,value:typeof v.value=="number"?v.value:Number((Number(v.value)*100).toFixed(2))})):i.sentiment_scores&&typeof i.sentiment_scores=="object"&&(t=Object.entries(i.sentiment_scores).map(([v,b])=>({name:v==="neutral"?"Neutral":v,value:Number((Number(b)*100).toFixed(2))})));let l=0;if(i.final_prediction){let v=t.find(b=>b.name.toLowerCase()===i.final_prediction?.toLowerCase());v?l=v.value:t.length>0&&(l=Math.max(...t.map(b=>b.value)))}let h={text:e,final_prediction:i.final_prediction,confidence:l,sentiment_scores:t,timestamp:new Date};this.predictionService.savePredictionToHistory(h),this.lastSinglePrediction=h,this.selectedHistoryItem=h,this.historyCurrentPage=0,this._cachedChartData=null,this.singlePredictionForm.reset()}catch(t){console.error("Error processing prediction result:",t),alert("Failed to process prediction result. Please try again.")}finally{this.isProcessingSinglePrediction=!1}},error:i=>{console.error("[DEBUG] Error in predictSingleText:",i),this.isProcessingSinglePrediction=!1,i.status===0?alert("Network error. Please check your internet connection and try again."):i.status===429?alert("Too many requests. Please wait a moment and try again."):alert(`Failed to process prediction: ${i.message||"Unknown error"}`)}}))}deleteCsvFile(e,i){i.stopPropagation();let t=this.csvFiles.findIndex(l=>l.id===e);t!==-1&&(this.csvFiles.splice(t,1),e===this.activeCsvFile&&this.csvFiles.length>0?this.activeCsvFile=this.csvFiles[0].id:this.csvFiles.length===0&&(this.activeCsvFile=""))}onFileSelected(e){let i=e.target,t=i?.files?.[0];i.value="",t&&this.fileUploadForm.patchValue({fileName:t.name,csvFile:t})}predictCsvFile(){let e=this.fileUploadForm.get("csvFile")?.value;if(!e){alert("Please select a file first");return}this.predictionService.uploadCsvForPrediction(e).subscribe({next:i=>{if(!i){alert("Failed to upload file. Please try again.");return}this.pendingFiles.findIndex(l=>l.id===i.fileId)===-1&&this.pendingFiles.push({id:i.fileId,name:i.name||e.name,timestamp:new Date(i.timestamp)||new Date}),this.fileUploadForm.reset(),this.pollFileStatus(i.fileId)},error:i=>{console.error("Error uploading file:",i),alert("Failed to upload file. Please try again.")}})}loadFileToVisualization(e){if(this.csvFiles.findIndex(t=>t.id===e)!==-1){this.activeCsvFile=e;return}this.predictionService.getFileDetails(e).subscribe({next:t=>{let l=this.generateChartDataFromApiResponse(t),h={id:e,name:t.name,status:"completed",timestamp:new Date(t.timestamp),isDefault:!1,data:t.data||[],chartData:l};this.csvFiles.push(h),this.activeCsvFile=e},error:t=>{console.error("Error loading file details:",t),alert("Failed to load file details. Please try again.")}})}get singlePredictionChartData(){if(!this.lastSinglePrediction)return{labels:[],datasets:[{data:[],backgroundColor:[]}]};if(this._cachedChartData&&this._lastPredictionTimeStamp===this.lastSinglePrediction.timestamp)return this._cachedChartData;let e={labels:this.lastSinglePrediction?.sentiment_scores?.map(i=>i.name)||[],datasets:[{data:this.lastSinglePrediction?.sentiment_scores?.map(i=>i.value)||[],backgroundColor:["rgba(25, 135, 84, 0.8)","rgba(13, 202, 240, 0.8)","rgba(108, 117, 125, 0.8)","rgba(255, 193, 7, 0.8)","rgba(220, 53, 69, 0.8)"],borderWidth:1}]};return this._cachedChartData=e,this._lastPredictionTimeStamp=this.lastSinglePrediction.timestamp||new Date,e}getPaginatedData(e,i,t){if(!e||!e.length)return[];let l=i*t,h=l+t;return e.slice(l,h)}getVisiblePageNumbers(e,i,t){let l=Math.ceil(e/i),h=[];if(l<=7)for(let v=0;v<l;v++)h.push(v);else{h.push(0),t>2&&h.push(-1);let v=Math.max(1,t-1),b=Math.min(l-2,t+1);for(let T=v;T<=b;T++)h.push(T);t<l-3&&h.push(-1),l>1&&h.push(l-1)}return h}changePage(e,i){if(i==="bulk"){let t=this.currentCsvFile?Math.ceil(this.currentCsvFile.data.length/this.pageSize):0;e>=0&&e<t&&(this.currentPage=e)}else{let t=Math.ceil(this.singlePredictionHistory.length/this.historyPageSize);e>=0&&e<t&&(this.historyCurrentPage=e)}}onPageSizeChange(e){e==="bulk"?this.currentPage=0:this.historyCurrentPage=0}getCategoryColor(e){return{"Very Negative":"rgba(220, 53, 69, 0.8)","Slightly Negative":"rgba(255, 193, 7, 0.8)",Neutral:"rgba(108, 117, 125, 0.8)","Slightly Positive":"rgba(13, 202, 240, 0.8)","Very Positive":"rgba(25, 135, 84, 0.8)"}[e]||"gray"}showCategoriesModal(e){console.log("Categories:",e),this.selectedCategories=e,this.showCategoryModal=!0,console.log("Categories:",e),setTimeout(()=>{this.showCategoryModal=!1},3e3)}pollFileStatus(e){this.fileStatusSubscriptions.has(e)&&this.fileStatusSubscriptions.get(e)?.unsubscribe();let i=!1,t=H(2e3).pipe(B(()=>!i)).subscribe({next:()=>{this.predictionService.checkFileStatus(e).subscribe({next:l=>{l.status==="completed"?(i=!0,this.pendingFiles=this.pendingFiles.filter(h=>h.id!==e),this.refreshFilesList(),this.fileStatusSubscriptions.has(e)&&(this.fileStatusSubscriptions.get(e)?.unsubscribe(),this.fileStatusSubscriptions.delete(e))):l.status==="error"&&(i=!0,this.pendingFiles=this.pendingFiles.filter(h=>h.id!==e),alert(`Processing of file failed: ${l.message||"Unknown error"}`),this.fileStatusSubscriptions.has(e)&&(this.fileStatusSubscriptions.get(e)?.unsubscribe(),this.fileStatusSubscriptions.delete(e)))},error:l=>{console.error("Error checking file status:",l),i=!0,this.fileStatusSubscriptions.has(e)&&(this.fileStatusSubscriptions.get(e)?.unsubscribe(),this.fileStatusSubscriptions.delete(e))}})}});this.fileStatusSubscriptions.set(e,t)}refreshFilesList(){this.predictionService.getFiles().subscribe({next:e=>{if(!e){console.error("Received null response from getFiles()");return}let i=new Set(this.pendingFiles.map(t=>t.id));if(e.pendingFiles&&Array.isArray(e.pendingFiles)){e.pendingFiles.forEach(l=>{i.has(l.id)||this.pendingFiles.push({id:l.id,name:l.name,timestamp:new Date(l.timestamp)})});let t=new Set(e.pendingFiles.map(l=>l.id));this.pendingFiles=this.pendingFiles.filter(l=>t.has(l.id))}e.completedFiles&&Array.isArray(e.completedFiles)&&(this.myFiles=e.completedFiles.map(t=>({id:t.id,name:t.name,status:"completed",timestamp:new Date(t.timestamp),isDefault:!1,data:[],chartData:void 0}))),this.filterFiles(),this.cdr.detectChanges()},error:e=>{console.error("Error fetching files:",e),this.cdr.detectChanges()}})}generateChartDataFromApiResponse(e){if(!e||!e.data)return{labels:[],datasets:[{label:"No Data Available",backgroundColor:[],borderColor:"rgba(179,181,198,1)",data:[]}]};let i={"Very Positive":0,"Slightly Positive":0,Neutral:0,"Slightly Negative":0,"Very Negative":0};return Array.isArray(e.data)&&e.data.forEach(t=>{let l=t?.Prediction;l&&Object.prototype.hasOwnProperty.call(i,l)&&i[l]++}),{labels:Object.keys(i),datasets:[{label:"Sentiment Distribution",backgroundColor:["rgba(25, 135, 84, 0.8)","rgba(13, 202, 240, 0.8)","rgba(108, 117, 125, 0.8)","rgba(255, 193, 7, 0.8)","rgba(220, 53, 69, 0.8)"],borderColor:"rgba(179,181,198,1)",data:Object.values(i)}]}}ngOnDestroy(){this.fileStatusSubscriptions.forEach(e=>e.unsubscribe()),this.fileStatusSubscriptions.clear()}navigateToTab(e){this.router.navigate(["/dashboard",e])}navigateToSubscription(){console.log("Navigating to subscription page..."),this.router.navigate(["/subscription"]).then(e=>{console.log("Navigation success:",e),e||(console.error("Navigation failed, trying window.location"),window.location.href="/subscription")}).catch(e=>{console.error("Navigation error:",e)})}get hasBulkAccess(){return this.subscriptionService.hasBulkAccess()}switchTab(e){this.activeTab=e,this.router.navigate(["/dashboard",e],{skipLocationChange:!1,replaceUrl:!1})}downloadFile(e){this.predictionService.downloadFile(e).subscribe({next:i=>{console.log("File downloaded successfully:",i)},error:i=>{console.error("Error downloading file:",i)}})}static{this.\u0275fac=function(i){return new(i||o)(C(K),C(we),C(Le),C(W),C(ee),C(te))}}static{this.\u0275cmp=G({type:o,selectors:[["app-dashboard"]],decls:18,vars:7,consts:[[1,"dashboard-container"],[1,"mx-auto",2,"max-width","90%","width","90%"],["layout","justified","variant","pills"],["cNavLink","",2,"cursor","pointer",3,"click","active"],["class","badge bg-secondary ms-1",4,"ngIf"],[4,"ngIf"],["class","premium-content-container",4,"ngIf"],["class","position-fixed","style","top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1050; max-width: 500px;",4,"ngIf"],["class","position-fixed top-0 start-0 w-100 h-100","style","background-color: rgba(0,0,0,0.5); z-index: 1040;",3,"click",4,"ngIf"],[1,"badge","bg-secondary","ms-1"],["xs","12","md","6"],[1,"mb-4"],["cForm","",3,"formGroup"],[1,"mb-3"],["cLabel","","for","exampleFormControlTextarea1"],["cFormControl","","id","exampleFormControlTextarea1","rows","3","formControlName","textInput"],[1,"d-flex","justify-content-end"],["cButton","","color","primary","type","button",3,"click","disabled"],["class","mb-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","table-responsive","style","max-height: 600px; overflow-y: auto;",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted"],["aria-label","History pages","size","sm",4,"ngIf"],["cSelect","","size","sm",2,"width","auto",3,"ngModelChange","change","ngModel","ngModelOptions"],[3,"value"],["type","pie",3,"data","options"],[1,"text-center","py-5"],[1,"table-responsive",2,"max-height","600px","overflow-y","auto"],["cTable","","hover",""],["style","cursor: pointer;",3,"selected-history-item","click",4,"ngFor","ngForOf"],[2,"cursor","pointer",3,"click"],[2,"max-width","200px","white-space","nowrap","overflow","hidden","text-overflow","ellipsis",3,"title"],[1,"badge"],[1,"badge","rounded-pill","bg-primary",2,"cursor","pointer",3,"click"],["aria-label","History pages","size","sm"],[3,"disabled"],["cPageLink","",2,"cursor","pointer",3,"click"],["aria-hidden","true"],[3,"active",4,"ngFor","ngForOf"],[3,"active"],[1,"premium-content-container"],["class","premium-tag",4,"ngIf"],["md","8"],["variant","tabs"],[4,"ngFor","ngForOf"],["md","4"],["cLabel","","for","formFile"],["cFormControl","","type","file","id","formFile","accept",".csv",3,"change"],["class","mt-2 mb-0",4,"ngIf"],[1,"d-grid"],["class","text-center py-3",4,"ngIf"],["style","max-height: 200px; overflow-y: auto;",4,"ngIf"],["class","text-end mt-2",4,"ngIf"],[1,"input-group"],["cFormControl","","type","text","placeholder","Search files...",3,"ngModelChange","input","ngModel","ngModelOptions"],["cButton","","color","secondary","variant","outline","type","button",3,"click",4,"ngIf"],["style","max-height: 240px; overflow-y: auto;",4,"ngIf"],["class","premium-overlay",4,"ngIf"],[1,"premium-tag"],["cNavLink","",1,"d-flex","align-items-center",3,"click","active"],["cButton","","color","danger","size","sm","variant","ghost","class","ms-2 p-0 px-1","style","line-height: 1;",3,"click",4,"ngIf"],["cButton","","color","danger","size","sm","variant","ghost",1,"ms-2","p-0","px-1",2,"line-height","1",3,"click"],["type","radar",3,"data","options"],[1,"d-flex","justify-content-between","align-items-center"],["cButton","","color","success","size","sm","variant","outline",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor",2,"transform","scaleY(-1)"],["d","M8 0a8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8 8 8 0 0 0-8-8zm0 2.5a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11zM6 8v3h4V8h2l-4-4-4 4h2z"],[1,"table-responsive",2,"max-height","450px","overflow-y","auto"],["aria-label","Data table pages","size","sm"],[1,"mt-2","mb-0"],[1,"text-center","py-3"],[1,"text-muted","mb-0"],[2,"max-height","200px","overflow-y","auto"],["cListGroup",""],["cListGroupItem","","class","d-flex align-items-center",4,"ngFor","ngForOf"],["cListGroupItem","",1,"d-flex","align-items-center"],["role","status",1,"spinner-border","spinner-border-sm","text-primary","me-2"],[1,"visually-hidden"],[1,"text-truncate"],[1,"text-muted","ms-auto"],[1,"text-end","mt-2"],["cButton","","color","secondary","variant","outline","type","button",3,"click"],[2,"max-height","240px","overflow-y","auto"],["cListGroupItem","","style","cursor: pointer;",3,"active","click",4,"ngFor","ngForOf"],["cListGroupItem","",2,"cursor","pointer",3,"click","active"],[1,"d-flex","align-items-center"],[1,"premium-overlay"],[1,"premium-message"],[1,"text-start","mb-4"],["cButton","","color","primary","size","lg",1,"px-4",3,"click"],[1,"mt-3"],["href","/subscription"],[1,"position-fixed",2,"top","50%","left","50%","transform","translate(-50%, -50%)","z-index","1050","max-width","500px"],["cButton","","color","secondary","variant","ghost","size","sm",3,"click"],["cTable","","striped",""],[1,"position-fixed","top-0","start-0","w-100","h-100",2,"background-color","rgba(0,0,0,0.5)","z-index","1040",3,"click"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"c-card",1)(2,"c-card-body")(3,"c-card")(4,"c-card-header")(5,"c-nav",2)(6,"c-nav-item")(7,"a",3),_("click",function(){return t.switchTab("single")}),s(8," Single Line Prediction "),r()(),n(9,"c-nav-item")(10,"a",3),_("click",function(){return t.switchTab("bulk")}),s(11," Bulk Prediction "),u(12,Be,2,0,"span",4),r()()()(),n(13,"c-card-body"),u(14,We,40,16,"div",5)(15,mt,48,21,"div",6),r()()()(),u(16,_t,16,1,"c-card",7)(17,ht,1,0,"div",8),r()),i&2&&(a(7),c("active",t.activeTab==="single"),a(3),c("active",t.activeTab==="bulk"),a(2),c("ngIf",!t.hasBulkAccess),a(2),c("ngIf",t.activeTab==="single"),a(),c("ngIf",t.activeTab==="bulk"),a(),c("ngIf",t.showCategoryModal),a(),c("ngIf",t.showCategoryModal))},dependencies:[J,Q,Y,q,fe,ve,ue,X,he,_e,ge,ne,re,Ne,De,Me,ze,Fe,Ie,Pe,Ee,Te,Ve,He,ae,xe,de,ce,pe,me,Oe,ke,oe,se,le,ie],styles:["[_nghost-%COMP%]   .legend[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:x-small}.dashboard-container[_ngcontent-%COMP%]{width:95%;margin:0 auto;padding:1rem}.dashboard-container[_ngcontent-%COMP%]   c-card[_ngcontent-%COMP%]{width:100%}c-card-body[_ngcontent-%COMP%]{width:100%}c-chart[_ngcontent-%COMP%]{display:block;width:100%;min-height:300px}.categories-summary[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:150px;cursor:help}.categories-summary[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{display:inline-block;padding:.25em .4em;border-radius:.25rem;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline}[title][_ngcontent-%COMP%]{position:relative}[title][_ngcontent-%COMP%]:hover:after{content:attr(title);position:absolute;bottom:100%;left:0;background:#000c;color:#fff;padding:5px 10px;border-radius:4px;font-size:.75rem;z-index:100;white-space:pre;min-width:150px}.premium-content-container[_ngcontent-%COMP%]{position:relative;width:100%}.premium-content-blur[_ngcontent-%COMP%]{filter:blur(2px);pointer-events:none;-webkit-user-select:none;user-select:none;opacity:.7}.premium-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;background:#0003;border-radius:5px}.premium-message[_ngcontent-%COMP%]{background-color:#fffffff2;padding:20px;border-radius:8px;text-align:center;box-shadow:0 4px 15px #00000026;max-width:90%;width:450px}.premium-tag[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;background-color:#f0ad4e;color:#fff;padding:5px 15px;border-radius:20px;font-weight:700;box-shadow:0 2px 5px #0003;z-index:11}"]})}}return o})();export{Ot as DashboardComponent};
