import{a as n}from"./chunk-ZY66MEJT.js";import{r as b}from"./chunk-L2SPN6SO.js";import{G as o,U as u,Z as a,ca as p,l as c}from"./chunk-EBI22OCP.js";var m=(()=>{class i{constructor(t){this.http=t,this.currentSubscription="free",this.backendSubscriptionStatus=!1;let e=localStorage.getItem("currentSubscription");e&&(this.currentSubscription=e),this.checkBackendSubscriptionStatus()}checkBackendSubscriptionStatus(){let t=localStorage.getItem("username");if(!t){console.log("No username found, defaulting to free plan");return}let e=n.apiUrl;this.http.get(`${e}/check-subscription?username=${t}`).subscribe({next:r=>{console.log("Backend subscription check response:",r),this.backendSubscriptionStatus=r.access||!1,this.backendSubscriptionStatus?this.setSubscription("pro"):this.setSubscription("free")},error:r=>{console.error("Error checking backend subscription:",r),this.backendSubscriptionStatus=!1,this.setSubscription("free")}})}getSubscriptionPlans(){return[{id:"free",name:"Free Plan",price:0,billingCycle:"monthly",features:["Single Line Predictions","Basic Result History","Standard Support"],isCurrent:this.currentSubscription==="free"},{id:"pro",name:"Pro Plan",price:19.99,billingCycle:"monthly",features:["Single Line Predictions","Bulk CSV Predictions","Advanced Analytics","Priority Support","Unlimited History"],isCurrent:this.currentSubscription==="pro"}]}getCurrentSubscription(){return this.currentSubscription}setSubscription(t){this.currentSubscription=t,localStorage.setItem("currentSubscription",t),t==="pro"?(this.backendSubscriptionStatus=!0,this.updateBackendSubscription(!0)):(this.backendSubscriptionStatus=!1,this.updateBackendSubscription(!1))}hasBulkAccess(){let t=this.currentSubscription==="pro";return console.log("Bulk access check:",{frontendSubscription:this.currentSubscription,frontendAccess:t,backendStatus:this.backendSubscriptionStatus,finalAccess:t&&this.backendSubscriptionStatus}),t&&this.backendSubscriptionStatus}processPurchase(t,e){return c(!0).pipe(o(1500),u(()=>{this.setSubscription(t)}))}updateBackendSubscription(t){let e=localStorage.getItem("username");if(!e){console.error("No username found for backend update");return}let r=n.apiUrl;this.http.post(`${r}/update-subscription`,{username:e,subscribed:t}).subscribe({next:s=>{console.log("Backend subscription updated:",s)},error:s=>{console.error("Error updating backend subscription:",s)}})}static{this.\u0275fac=function(e){return new(e||i)(p(b))}}static{this.\u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{m as a};
